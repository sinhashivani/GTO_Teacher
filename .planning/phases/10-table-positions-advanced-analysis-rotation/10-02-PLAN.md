---
phase: 10-table-positions-advanced-analysis-rotation
plan: 02
type: execute
wave: 2
depends_on: [01]
files_modified: [src/components/poker/PlayerSeat.tsx, src/components/poker/SettingsDialog.tsx, src/lib/db.ts, src/lib/poker/state-machine.ts, src/components/poker/GameController.tsx]
autonomous: true
requirements: [PH10-UI-LABELS, PH10-CARD-REVEAL]
---

<objective>
Update UI to show position labels and implement card reveal logic when Hero folds.

Purpose: To clarify table positions for the player and provide feedback on bot holdings after the player exits a hand.
Output: Position labels (BTN, SB, BB, etc.) visible on PlayerSeat, a toggle in Settings, and bot cards revealed on Hero fold.
</objective>

<execution_context>
@C:/Users/sinha/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/sinha/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/10-table-positions-advanced-analysis-rotation/10-CONTEXT.md
@src/components/poker/PlayerSeat.tsx
@src/components/poker/SettingsDialog.tsx
@src/lib/poker/state-machine.ts
@src/components/poker/GameController.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Position Labels in PlayerSeat</name>
  <files>src/components/poker/PlayerSeat.tsx, src/lib/db.ts, src/components/poker/SettingsDialog.tsx</files>
  <action>
    - Add `positionLabel?: string` prop to `PlayerSeatProps` in `PlayerSeat.tsx`.
    - Render a position badge (e.g., "BTN", "UTG") if `positionLabel` is provided.
    - Add `showPositionLabels: boolean` to `UserSettings` in `db.ts` (default: `true`).
    - Add a switch in `SettingsDialog.tsx` to toggle `showPositionLabels`.
  </action>
  <verify>
    <automated>Check for `showPositionLabels` in `db.ts` schema.</automated>
    <manual>Verify position labels are visible on the table and toggleable from settings.</manual>
  </verify>
  <done>Position labels are visible and toggleable in the UI.</done>
</task>

<task type="auto">
  <name>Task 2: Reveal Bot Cards on Hero Fold</name>
  <files>src/lib/poker/state-machine.ts, src/components/poker/GameController.tsx</files>
  <action>
    - Modify `PokerGame.getPublicState` in `state-machine.ts` to reveal all non-folded bot cards if `p1` (Hero) is folded.
    - Logic: `(p.id === playerId || state.stage === 'SHOWDOWN' || (heroFolded && !p.isFolded))`.
    - Update `GameController.tsx` to pass the `heroFolded` status into `getPublicState` or ensure it's calculated correctly inside.
  </action>
  <verify>
    <automated>npm test src/lib/poker/__tests__/engine.test.ts</automated>
    <manual>Fold preflop; verify you can see the bot's hole cards immediately.</manual>
  </verify>
  <done>Bot cards are revealed if Hero folds or hand is over.</done>
</task>

</tasks>

<verification>
- Position badges are correctly styled and visible on all seats.
- Bot cards are visible after Hero folds.
- Settings toggle works as expected.
</verification>

<success_criteria>
- BTN/SB/BB/etc badges appear correctly.
- Card reveal logic works without showing cards to non-folded Hero.
</success_criteria>

<output>
After completion, create `.planning/phases/10-table-positions-advanced-analysis-rotation/10-02-SUMMARY.md`
</output>

---
phase: 10-table-positions-advanced-analysis-rotation
plan: 03
type: execute
wave: 3
depends_on: [02]
files_modified: [src/lib/poker/bot.ts, src/lib/poker/types.ts, src/components/poker/GameController.tsx, src/lib/db.ts, src/components/poker/RoundReportModal.tsx]
autonomous: true
requirements: [PH10-GTO-METRICS, PH10-PERSISTENCE]
---

<objective>
Update BotAI to provide action scores and implement persistence for advanced GTO metrics (Accuracy, EV Delta, Leaks).

Purpose: To provide deeper insights into Hero's performance and identify recurring strategic mistakes.
Output: Scored actions from BotAI, EV Delta calculation, and a detailed RoundReportModal with leak identification.
</objective>

<execution_context>
@C:/Users/sinha/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/sinha/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/10-table-positions-advanced-analysis-rotation/10-CONTEXT.md
@src/lib/poker/bot.ts
@src/lib/poker/types.ts
@src/components/poker/GameController.tsx
@src/lib/db.ts
@src/components/poker/RoundReportModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update BotAI to Return Action Scores</name>
  <files>src/lib/poker/bot.ts, src/lib/poker/types.ts</files>
  <action>
    - Add `scores?: Record<ActionType, number>` to `Action` interface in `types.ts`.
    - Update `BotAI.expertLogic` to calculate and return weights for each action (0.0 - 1.0).
    - Example: Strong hand might have RAISE: 0.8, CALL: 0.2, FOLD: 0.0.
    - Simple scoring based on hand strength thresholds and pot odds is sufficient for this phase.
  </action>
  <verify>
    <manual>Log bot action scores in console and verify they sum to ~1.0.</manual>
  </verify>
  <done>BotAI returns relative scores for all legal actions.</done>
</task>

<task type="auto">
  <name>Task 2: Calculate EV Delta and Track Leaks</name>
  <files>src/components/poker/GameController.tsx, src/lib/db.ts</files>
  <action>
    - In `onPlayerAction`, calculate `evDelta = bestActionScore - heroActionScore`.
    - Identify "Leaks": if `evDelta > 0.5`, categorize the mistake (e.g., "Over-folding preflop", "Passive play with strong hands").
    - Update `HandHistory` interface in `db.ts` to include `evDelta` (average per hand) and `leaks` (array of strings).
    - Persist these metrics to Dexie.
  </action>
  <verify>
    <automated>Verify database schema update in `db.ts`.</automated>
    <manual>Check Dexie DB after playing a hand to see if `evDelta` and `leaks` are recorded.</manual>
  </verify>
  <done>GTO metrics are calculated and persisted for every Hero hand.</done>
</task>

<task type="auto">
  <name>Task 3: Detailed GTO Summary in RoundReportModal</name>
  <files>src/components/poker/RoundReportModal.tsx</files>
  <action>
    - Add a "GTO Analysis" tab or section to `RoundReportModal`.
    - Display aggregate metrics: "Overall Accuracy", "Average EV Loss/Hand", and a "Recurring Leaks" list.
    - Visualize leaks using a simple frequency bar or list.
  </action>
  <verify>
    <manual>Open RoundReportModal (press 'R') and verify the new GTO Analysis section.</manual>
  </verify>
  <done>Detailed GTO metrics are clearly visible in the session report.</done>
</task>

</tasks>

<verification>
- EV Delta is calculated for every player action.
- Leaks are identified based on deviations.
- Report modal shows historical trends.
</verification>

<success_criteria>
- Metrics are persisted across sessions.
- Leaks are logically categorized (e.g., street-based or action-based).
</success_criteria>

<output>
After completion, create `.planning/phases/10-table-positions-advanced-analysis-rotation/10-03-SUMMARY.md`
</output>

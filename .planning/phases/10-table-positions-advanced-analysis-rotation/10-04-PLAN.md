---
phase: 10-table-positions-advanced-analysis-rotation
plan: 04
type: execute
wave: 4
depends_on: [03]
files_modified: [src/components/poker/GameController.tsx, src/components/poker/BotInspectionModal.tsx, src/lib/poker/bot.ts, src/components/poker/PlayerSeat.tsx]
autonomous: true
requirements: [PH10-BOT-ROTATION, PH10-BOT-INSPECTION]
---

<objective>
Implement dynamic bot rotation (leaving/refilling) and a bot inspection modal for performance analysis.

Purpose: To simulate a lively tavern environment where players come and go based on their bankroll, and to allow players to study bot tendencies.
Output: Bots quitting at thresholds, automated refill logic with skill diversity, and a modal showing bot performance vs skill profile.
</objective>

<execution_context>
@C:/Users/sinha/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/sinha/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/10-table-positions-advanced-analysis-rotation/10-CONTEXT.md
@src/components/poker/GameController.tsx
@src/lib/poker/bot.ts
@src/components/poker/PlayerSeat.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bot Performance Tracking & Modal</name>
  <files>src/components/poker/BotInspectionModal.tsx, src/components/poker/GameController.tsx, src/components/poker/PlayerSeat.tsx</files>
  <action>
    - Create `BotInspectionModal.tsx` component.
    - Show bot metadata: name, avatar, difficulty, and "Play Style" description.
    - Display "Recent Performance": A list of the bot's last 5 actions and whether they were "characteristic" of their skill level (e.g., Easy bot calling wide).
    - Reveal hole cards ONLY if Hero has folded (`heroFolded` from `GameController`).
    - Update `PlayerSeat.tsx` to be clickable (if it's a bot) to open this modal.
    - In `GameController.tsx`, maintain a `botPerformance` ref or state to track these actions.
  </action>
  <verify>
    <manual>Click a bot seat during a hand; verify modal opens. Fold Hero and check if bot cards are then visible in the modal.</manual>
  </verify>
  <done>Bot inspection modal is functional and respects the card reveal privacy rule.</done>
</task>

<task type="auto">
  <name>Task 2: Dynamic Bot Quitting & Refill Logic</name>
  <files>src/components/poker/GameController.tsx, src/lib/poker/bot.ts</files>
  <action>
    - In `GameController.tsx`, update the settlement effect to identify bots that should quit.
    - Instead of a hard `router.push('/')`, mark the seat as `empty` or remove the player from the session state.
    - Implement `pendingRefills`: An array of `{ seatIndex: number, handsLeft: number }`.
    - At the start of each hand (in `onNextHand`), decrement `handsLeft`. If 0, spawn a new bot.
    - Weighted expertise selection: 30% Expert, 40% Medium, 30% Easy.
    - Ensure `startingStack` for new bots matches the table settings.
  </action>
  <verify>
    <manual>Play until a bot goes broke. Verify they leave the table (seat goes empty). Verify a new bot with a different name joins 1-3 hands later.</manual>
  </verify>
  <done>Table remains dynamic with bots leaving and joining automatically.</done>
</task>

</tasks>

<verification>
- Bots quit correctly at thresholds.
- Seats are refilled after 1-3 hands.
- Bot diversity is maintained via weighted selection.
- Inspection modal correctly reveals/hides cards based on Hero state.
</verification>

<success_criteria>
- No table "stalls" when bots leave.
- Refill timing is randomized as requested.
- UI handles empty seats gracefully.
</success_criteria>

<output>
After completion, create `.planning/phases/10-table-positions-advanced-analysis-rotation/10-04-SUMMARY.md`
</output>

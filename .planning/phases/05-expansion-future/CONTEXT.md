# CONTEXT: Phase 5 - Expansion

## User Instructions
Implement and verify the following in the existing Next.js App Router + TypeScript poker trainer “GTO Teacher”, keep the pixel tavern aesthetic, do not break existing single opponent mode; add a repeatable functionality verification pass, include a dev only in app debug panel showing street, pot, stacks, whose turn, legal actions, and add automated unit tests for engine transitions and action legality where feasible, and write a short UAT checklist in the .planning outputs describing how to manually verify the app end to end; ensure the top right settings menu toggles for coaching timing, show recommendations, show opponent insights, hand history, etc do not reset or interfere with an active hand, settings must only affect rendering and coaching overlays, never mutate or reset the underlying hand state, if any setting requires a reset then queue it and label it “applies next hand”; add a Leave Game option in the top right menu, on click show a confirm modal “Leave current hand, this will forfeit the hand”, if confirmed end the current hand as a forfeit, persist it to history with reason=left game, then route back to the Lobby screen; implement multiplayer local bots with 2 to 6 seats, add a Table Setup step allowing user to choose player count 2,3,4,5,6, hero is always one seat and remaining seats are bots, no networking, bots must act only on public info plus their hole cards plus action history, bots must not see deck order, enforce turn order, betting rounds, and pot handling for multiple seats, support all ins and side pots if feasible, if side pots are too heavy in this iteration then implement a clearly stated temporary constraint in UI and create a follow up plan to remove it; implement bot difficulty modes applied to all bots at the table, Easy all bots play average player style with common leaks and simple heuristics, Medium all bots play experienced solid fundamentals, Expert all bots play strongest available baseline for supported spots, Mixed each bot gets a different skill profile and small style variance not necessarily GTO so hero uses GTO coaching to win; add Turn and River by extending state machine Preflop to Flop to Turn to River to Showdown, update dealing, board rendering, and action availability per street, keep betting rules consistent, update coaching to work on turn and river with recommended action plus short rationale, if expert baseline does not cover a spot then degrade gracefully and label advice as heuristic; update persistence so table setup and coaching toggles persist in Dexie and survive refresh, persist full hand history including players, stacks, board per street, action log, results, and flags like left game; deliver in small commits with a summary listing new screens and how to run locally, include a UAT checklist covering single player, multiplayer with 3 plus seats, each difficulty mode, mixed mode, toggles during a hand, leave game, turn river progression, and history persistence; acceptance criteria, bots always act when it is their turn across all player counts, settings toggles never reset or corrupt an active hand, leave game exits cleanly and records the forfeit, turn and river complete without freezes, app runs locally and deploys on Vercel.


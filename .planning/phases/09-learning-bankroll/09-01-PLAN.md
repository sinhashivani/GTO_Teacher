# PLAN: 09-01 - Bankroll Controls & Credit Mode

Goal: Add destructive bankroll reset actions, configurable starting stacks, and an optional "Credit Mode" allowing negative balances.

## Proposed Changes

### 1. Database & Persistence (`src/lib/db.ts`)
- Update `UserSettings` interface:
  - `creditMode: boolean`
  - `creditLimit: number` (default -2000)
  - `startingStack: number` (default 1000)
- Bump DB version to 6.

### 2. Bankroll Logic (`src/lib/poker/bankroll.ts`)
- Implement `resetHeroBankroll()` and `resetAllBankrolls()`.
- Ensure bankroll values are persisted correctly in `localStorage`.

### 3. Betting Engine (`src/lib/poker/betting.ts`)
- Update `handleAction` to respect `creditMode` and `creditLimit`.
- If `creditMode` is ON, allow `stack - amount` to go below 0 as long as it's `>= creditLimit`.
- If `creditMode` is OFF, enforce `stack >= amount` (existing behavior).

### 4. Bot Adaptation (`src/lib/poker/bot.ts`)
- Update `BotAI` to handle its own "Credit Limit" based on difficulty thresholds.
- Ensure bots don't crash when stack is negative.
- Bots should FOLD or SHOVE if a call would exceed their credit limit.

### 5. UI: Settings & Confirmation (`src/components/poker/SettingsDialog.tsx`)
- Add controls for:
  - Starting Stack (100, 500, 1000, 2000, 5000)
  - Credit Mode (Toggle)
  - Credit Limit (-1000, -2000, -5000)
- Implement confirmation modals for "Reset Hero Bankroll" and "Reset All".
- Ensure these buttons are clearly labeled as "Apply Next Hand".

## Verification Plan

### Automated Tests
- Create `src/lib/poker/__tests__/credit.test.ts`:
  - Test `handleAction` allows negative stacks in Credit Mode.
  - Test `handleAction` throws "Insufficient Credit" if limit exceeded.
  - Test Bot behavior at credit threshold.

### Manual Verification
- Reset bankroll from settings and verify it applies next hand.
- Enable Credit Mode, bet into the negative, and verify limit is enforced.
- Verify bot quitting threshold still triggers correctly after settlement.

---
phase: 01-scaffolding-core-engine
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [
  "src/lib/poker/card.ts",
  "src/lib/poker/deck.ts",
  "src/lib/poker/evaluator.ts",
  "src/lib/poker/types.ts",
  "package.json",
  "src/lib/poker/__tests__/deck.test.ts",
  "src/lib/poker/__tests__/evaluator.test.ts"
]
autonomous: true
requirements: [PH1-LOGIC, PH1-EVAL]
---

<objective>
Implement the core Poker Engine foundation: card/deck management and hand evaluation using `@pokertools/evaluator`.

Purpose: Provide the logic needed to manage hands, deal cards, and determine the winner.
Output: A set of utility classes/functions and unit tests for poker hand evaluation.
</objective>

<execution_context>
@C:/Users/sinha/.gemini/get-shit-done/workflows/execute-plan.md
@C:/Users/sinha/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/research/RESEARCH.md
@.planning/phases/01-scaffolding-core-engine/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Card and Deck Logic</name>
  <files>src/lib/poker/types.ts, src/lib/poker/card.ts, src/lib/poker/deck.ts, src/lib/poker/__tests__/deck.test.ts</files>
  <action>
    1. Define `Suit` (h, d, s, c) and `Rank` (2-9, T, J, Q, K, A) types in `src/lib/poker/types.ts`.
    2. Create a `Card` class or type that represents a single card with rank and suit.
    3. Create a `Deck` class that:
       - Generates a full 52-card deck.
       - Implements a `shuffle()` method using the Fisher-Yates algorithm.
       - Implements a `draw(count: number): Card[]` method to deal cards from the top.
    4. Ensure the output formats are compatible with `@pokertools/evaluator` (typically strings like 'Ah', 'Ks').
  </action>
  <verify>
    <automated>node --test src/lib/poker/__tests__/deck.test.ts</automated>
    <manual>Verify that calling Deck.draw(5) returns 5 unique cards from a shuffled deck.</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>Deck and Card logic is functional and correctly deals unique cards.</done>
</task>

<task type="auto">
  <name>Task 2: Hand Evaluation</name>
  <files>src/lib/poker/evaluator.ts, src/lib/poker/__tests__/evaluator.test.ts, package.json</files>
  <action>
    1. Install `@pokertools/evaluator` via npm: `npm install @pokertools/evaluator`.
    2. Create a `evaluateHand(holeCards: Card[], communityCards: Card[]): HandResult` function in `src/lib/poker/evaluator.ts`.
    3. `HandResult` should include:
       - Score (numeric for comparison)
       - Category (e.g., 'Flush', 'Full House')
       - Human-readable name (e.g., 'Pair of Aces')
    4. Handle the case where community cards are less than 5 (Flop: 3 cards).
    5. Write unit tests in `src/lib/poker/__tests__/evaluator.test.ts` to verify common hand types (Pair, Straight, Flush, etc.).
  </action>
  <verify>
    <automated>node --test src/lib/poker/__tests__/evaluator.test.ts</automated>
    <manual>Confirm that 'Ah Ad' vs '2s 3d 4c 5h 7s' correctly evaluates as a Pair of Aces.</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>Hand evaluation is accurate and covered by unit tests.</done>
</task>

</tasks>

<must_haves>
  truths:
    - "A shuffled deck contains 52 unique cards"
    - "Hand evaluator returns a comparable score"
    - "Hand category (e.g., 'Flush') is correctly identified"
  artifacts:
    - path: "src/lib/poker/deck.ts"
      provides: "Card and deck management"
    - path: "src/lib/poker/evaluator.ts"
      provides: "Hand evaluation logic"
  key_links:
    - from: "src/lib/poker/evaluator.ts"
      to: "@pokertools/evaluator"
      via: "import and call"
</must_haves>

<success_criteria>
- Unit tests for Deck and Evaluator pass with 100% success.
- Hand evaluator can distinguish between a Pair and a Straight.
- The deck can be shuffled and cards can be drawn.
</success_criteria>

<output>
After completion, create `.planning/phases/01-scaffolding-core-engine/01-02-SUMMARY.md`
</output>
